name: Build iOS App
on:
  repository_dispatch:
    types: [build-ios-app]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Notify Lovable (Started)
        run: |
          curl -X POST https://your-lovable-project-url.lovable.app/functions/v1/build-webhook \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ secrets.BUILD_WEBHOOK_SECRET }}" \
          -d '{"build_id": "${{ github.event.client_payload.build_id }}", "status": "processing"}'

      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
          bundler-cache: true

      - name: Build and Upload iOS no App
        run: |
            bundle install
            bundle exec fastlane beta

            - name: Notify Lovable (Success)
        if: success()
        run: |
          curl -X POST https://your-lovable-project-url.lovable.app/functions/v1/build-webhook \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ secrets.BUILD_WEBHOOK_SECRET }}" \
          -d '{"build_id": "${{ github.event.client_payload.build_id }}", "status": "completed"}'
